<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Action Delays, Calls, And Routines (Part 4) &#8211; Joshua Louderback</title>
<meta name="description" content="How To Add Action Calls, Delays and Routines!">
<meta name="keywords" content="Unity, Action, Actions, Action Call, ActionCall, Action Delay, ActionDelay, Action Routine, Programming, Tips">



<!-- Twitter Cards -->
<meta name="twitter:title" content="Action Delays, Calls, And Routines (Part 4)">
<meta name="twitter:description" content="How To Add Action Calls, Delays and Routines!">
<meta name="twitter:site" content="@joshlouderback">
<meta name="twitter:creator" content="@joshlouderback">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/default-thumb.png">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Action Delays, Calls, And Routines (Part 4)">
<meta property="og:description" content="How To Add Action Calls, Delays and Routines!">
<meta property="og:url" content="/AllTheActions/">
<meta property="og:site_name" content="Joshua Louderback">

<meta property="og:image" content="/images/default-thumb.png">






<link rel="canonical" href="/AllTheActions/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Joshua Louderback Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="/assets/js/vendor/html5shiv.min.js"></script>
	<script src="/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="/">Joshua Louderback</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				    
				        
				    
				    <li><a href="/projects/" >Projects</a></li>
				
				    
				        
				    
				    <li><a href="/posts/" >Blog</a></li>
				
				    
				        
				    
				    <li><a href="/resume/" >Resume</a></li>
				
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main">
  <div class="article-author-side">
    


<div itemscope itemtype="http://schema.org/Person">


	<img src="/images/bio-photo.jpg" class="bio-photo" alt="Joshua Louderback bio photo">


  <h3 itemprop="name">Joshua Louderback</h3>
  <p>Junior BSCS RTIS At DigiPen. Tools And Systems Programmer.</p>
  <a href="mailto:joshlouderback@gmail.com" class="author-social" target="_blank"><i class="fa fa-fw fa-envelope-square"></i> Email</a>
  <a href="http://twitter.com/joshlouderback" class="author-social" target="_blank"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a>
  
  
  <a href="http://linkedin.com/in/joshualouderback" class="author-social" target="_blank"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a>
  
  
  
  <a href="http://github.com/joshualouderback" class="author-social" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a>
  
  
  
  
  
  
  
  
  
  
  
</div>

  </div>
  <article class="post">
    <div class="headline-wrap">
      
        <h1><a href="/AllTheActions/" rel="bookmark" title="Action Delays, Calls, And Routines (Part 4)">Action Delays, Calls, And Routines (Part 4)</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <h3 id="all-the-actions">All The Actions</h3>

<p>Now that we have everything we need to manage flow of our Actions, we need the Actions that actually let us do actions! The toolkit of Actions are really simple and that is what so great about Actions. We have Action Delays, which simply just waits for a specified time. Next is Action Calls, and they just call a single frame function. Then there are Action Routines, just in case we want a multi-frame function and why wouldn’t we?! Coroutines are awesome! Now let’s get on with it!</p>

<h3 id="action-delay">Action Delay:</h3>

<p>Action Delaying is really simple. All we want is a simple timer that waits until the set time is up. The only thing important to note here is that why didn’t we just utilize WaitForSeconds(duration)? If you don’t know what WaitForSeconds is, it is a YieldInstruction you can return that tells a Coroutine to yield for that duration. So again, why not? It encapsulates everything we want, and we don’t have to manage our own timer every frame… Well, what happens when we pause? If we use WaitForSeconds, nothing, because it won’t know it is paused until after it returns from waiting the full duration we specified. That on its own competely destroys the reliablity we are trying to build with Actions. We want to be able to just code our logic without having to worry about edge cases, and using WaitForSeconds would cause users to have to be aware of that edge case. Since the goal is making life easier, we use our own timers rather than utilizing Coroutine functionality.</p>

<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">public</span> <span class="k">class</span> <span class="nc">ActionDelay</span> <span class="p">:</span> <span class="n">Action</span>
<span class="p">{</span>
  <span class="k">private</span> <span class="kt">float</span> <span class="n">timeLeft_</span><span class="p">;</span> <span class="c1">// Time left to wait</span>

  <span class="c1">// Constructor to add delay to manager and set timer</span>
  <span class="k">public</span> <span class="nf">ActionDelay</span><span class="p">(</span><span class="n">ActionManager</span> <span class="n">manager</span><span class="p">,</span> <span class="kt">float</span> <span class="n">duration</span><span class="p">)</span> 
  <span class="p">{</span> 
    <span class="n">timeLeft_</span> <span class="p">=</span> <span class="n">duration</span><span class="p">;</span>
    <span class="n">SetParent</span><span class="p">(</span><span class="n">manager</span><span class="p">);</span>
    <span class="n">AddAction</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Coroutine for updating delays</span>
  <span class="k">public</span> <span class="k">override</span> <span class="n">IEnumerator</span> <span class="nf">Update</span> <span class="p">()</span>
  <span class="p">{</span>
    <span class="c1">// We have started running</span>
    <span class="n">running_</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>

    <span class="c1">// Delay until there is no time left to wait</span>
    <span class="k">while</span><span class="p">(</span><span class="n">timeLeft_</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="c1">// If we are not paused, decrement time</span>
      <span class="k">if</span><span class="p">(!</span><span class="n">IsPaused</span><span class="p">())</span>
        <span class="n">timeLeft_</span> <span class="p">-=</span> <span class="n">Time</span><span class="p">.</span><span class="n">deltaTime</span><span class="p">;</span>
      <span class="c1">// yield until timer stops</span>
      <span class="k">yield</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span> 
    <span class="p">}</span>

    <span class="c1">// Mark action as completed, and break yields</span>
    <span class="n">completed_</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="k">yield</span> <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>	
<span class="p">}</span></code></pre></div>

<h3 id="actioncall">ActionCall:</h3>

<p>Action Calls are one of the biggest workers of the Action System. Here is where you will be writing the logic in the next step in your sequence, or logic that is meant to run simultaneously within its group. They can be simple things, for example calling a sound effect, or it can be the next step within some complex logic. Just remember that Action Calls are single frame functions. What I mean by this is that we call this function in our current frame; it runs the code and then leaves the function all in the same frame. This is important because our Action system expects to just call this function and move on, but if we have logic that is running off into the wild we have no idea what could happen! That is why we have Action Routines, for those multi-frame functions.</p>

<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">public</span> <span class="k">class</span> <span class="nc">ActionCall</span> <span class="p">:</span> <span class="n">Action</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="k">delegate</span> <span class="k">void</span> <span class="nf">Function</span><span class="p">();</span> <span class="c1">// Delegates for ActionCall must be of this type</span>
  <span class="k">private</span> <span class="n">Function</span> <span class="n">function_</span><span class="p">;</span>      <span class="c1">// Store the delegate the user attaches to this action</span>

  <span class="c1">// Constructor, provide function for action call</span>
  <span class="k">public</span> <span class="nf">ActionCall</span><span class="p">(</span><span class="n">ActionManager</span> <span class="n">manager</span><span class="p">,</span> <span class="n">Function</span> <span class="n">function</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">function_</span> <span class="p">=</span> <span class="n">function</span><span class="p">;</span>
    <span class="n">SetParent</span><span class="p">(</span><span class="n">manager</span><span class="p">);</span>
    <span class="n">AddAction</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Coroutine that updates action calls</span>
  <span class="k">public</span> <span class="k">override</span> <span class="n">IEnumerator</span> <span class="nf">Update</span> <span class="p">()</span> 
  <span class="p">{</span>
    <span class="c1">// We have started running</span>
    <span class="n">running_</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>

    <span class="c1">// While we are paused, wait</span>
    <span class="k">while</span><span class="p">(</span><span class="n">IsPaused</span><span class="p">())</span> 
    <span class="p">{</span>
      <span class="k">yield</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Activate single frame function </span>
    <span class="n">function_</span><span class="p">();</span>
    <span class="c1">// Mark as complete, and break yieldings</span>
    <span class="n">completed_</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="k">yield</span> <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>	
<span class="p">}</span></code></pre></div>

<p>One thing I would like to point out is that our ActionCall functions take nothing and return nothing. Why we have no return type is quite obvious, since after the function is run it comes back to the Action System, and then what is it going to do with it? The Action System is generic and shouldn’t ever care about what happened in your function. Now I’ve only been using C# for about 4 months when I wrote this system and could not find any good ways to support a varadic number of parameters. From my understanding there are no variadic functions in C#, well the only option is to use params object[] and I don’t like that. I didn’t want to require the user to have to remember how they laid out their parameters, which is error prone. Now, if you are in C++ you can use the lovely std::function&lt;void()&gt; that allows you to pass in a functor with any number of parameters! Sadly, there are also no functors within C# either. But, I’ve seen some sources of people writing their own and will probably go back and do that when I am able. If anyone has any better solutions, I would love to know!</p>

<h3 id="action-routine">Action Routine:</h3>

<p>The only things different here from ActionCall is that we require a Coroutine instead and we need to override Cancel. Since we are creating another Coroutine, we need the ActionRoutine to manage it. So, if we are cancelled, it can end the routine it started as well as itself.</p>

<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">public</span> <span class="k">class</span> <span class="nc">ActionRoutine</span> <span class="p">:</span> <span class="n">Action</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="k">delegate</span> <span class="n">IEnumerator</span> <span class="nf">Function</span><span class="p">();</span>
  <span class="k">private</span> <span class="n">Function</span> <span class="n">function_</span><span class="p">;</span>
  <span class="k">protected</span> <span class="n">Coroutine</span> <span class="n">actionRoutine_</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>

  <span class="k">public</span> <span class="nf">ActionRoutine</span><span class="p">(</span><span class="n">ActionManager</span> <span class="n">manager</span><span class="p">,</span> <span class="n">Function</span> <span class="n">function</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">function_</span> <span class="p">=</span> <span class="n">function</span><span class="p">;</span>
    <span class="n">SetParent</span><span class="p">(</span><span class="n">manager</span><span class="p">);</span>
    <span class="n">AddAction</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Cancel</span> <span class="p">()</span>
  <span class="p">{</span>
    <span class="c1">// Cancel the routine we started</span>
    <span class="k">if</span><span class="p">(</span><span class="n">parent_</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">actionRoutine_</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
      <span class="n">parent_</span><span class="p">.</span><span class="n">GetTarget</span><span class="p">().</span><span class="n">StopCoroutine</span><span class="p">(</span><span class="n">actionRoutine_</span><span class="p">);</span>

    <span class="c1">// Then call our base class to cancel ourselves</span>
    <span class="k">base</span><span class="p">.</span><span class="n">Cancel</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="c1">// Update is called once per frame</span>
  <span class="k">public</span> <span class="k">override</span> <span class="n">IEnumerator</span> <span class="nf">Update</span> <span class="p">()</span> 
  <span class="p">{</span>
    <span class="c1">// We have started running</span>
    <span class="n">running_</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>

    <span class="c1">// While we are paused, wait</span>
    <span class="k">while</span><span class="p">(</span><span class="n">IsPaused</span><span class="p">())</span> 
    <span class="p">{</span>
      <span class="k">yield</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Wait until we return from the function</span>
    <span class="n">actionRoutine_</span> <span class="p">=</span> <span class="n">parent_</span><span class="p">.</span><span class="n">GetTarget</span><span class="p">().</span><span class="n">StartCoroutine</span><span class="p">(</span><span class="n">function_</span><span class="p">());</span>
    <span class="k">yield</span> <span class="k">return</span> <span class="n">actionRoutine_</span><span class="p">;</span>
    <span class="n">completed_</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>

    <span class="c1">// We are complete, break yielding</span>
    <span class="k">yield</span> <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>	
<span class="p">}</span></code></pre></div>

<p>Okay, I lied about this article including all the Actions! The only Action we have left are ActionProperties, and they were the bane of my existence. I wanted to seperate them into their own article, so I could talk about how I ended up implementing them the way I did. It definitely was a journey!</p>

<blockquote>

</blockquote>

<p><a href="http://joshualouderback.com/ActionProperties/">Continue to part 5. (Action Properties)</a></p>

      <hr />
      <footer role="contentinfo">
        <div class="social-share">
  <h4>Share on</h4>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=/AllTheActions/" class="twitter" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=/AllTheActions/" class="facebook" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=/AllTheActions/" class="google-plus" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
  </ul>
</div><!-- /.social-share -->
        <p class="byline"><strong>Action Delays, Calls, And Routines (Part 4)</strong> was published on <time datetime="2016-01-26T00:00:00-08:00">January 26, 2016</time> and last modified on <time datetime="2016-01-30">January 30, 2016</time>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="/posts/">View all posts</a>)</small></h4>
    <ul>
    
      <li><a href="/ActionFoundation/" title="Action Foundations (Part 1)">Action Foundations (Part 1)</a></li>
    
      <li><a href="/ActionManagement/" title="Action Management (Part 2)">Action Management (Part 2)</a></li>
    
      <li><a href="/AddingActions/" title="Adding Actions (Part 2.5)">Adding Actions (Part 2.5)</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  
  <footer>
    

<span>&copy; 2016 Joshua Louderback. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a> theme.</span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-74044890-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


  




</body>
</html>
