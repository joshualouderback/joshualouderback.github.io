<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Action Foundations (Part 1) &#8211; Joshua Louderback</title>
<meta name="description" content="Actions and Coroutines!">
<meta name="keywords" content="Unity, Action, Actions, Programming, Tips">



<!-- Twitter Cards -->
<meta name="twitter:title" content="Action Foundations (Part 1)">
<meta name="twitter:description" content="Actions and Coroutines!">
<meta name="twitter:site" content="@joshlouderback">
<meta name="twitter:creator" content="@joshlouderback">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/default-thumb.png">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Action Foundations (Part 1)">
<meta property="og:description" content="Actions and Coroutines!">
<meta property="og:url" content="/ActionFoundation/">
<meta property="og:site_name" content="Joshua Louderback">

<meta property="og:image" content="/images/default-thumb.png">






<link rel="canonical" href="/ActionFoundation/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Joshua Louderback Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="/assets/js/vendor/html5shiv.min.js"></script>
	<script src="/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="/">Joshua Louderback</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				    
				        
				    
				    <li><a href="/projects/" >Projects</a></li>
				
				    
				        
				    
				    <li><a href="/posts/" >Blog</a></li>
				
				    
				        
				    
				    <li><a href="/resume/" >Resume</a></li>
				
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main">
  <div class="article-author-side">
    


<div itemscope itemtype="http://schema.org/Person">


	<img src="/images/bio-photo.jpg" class="bio-photo" alt="Joshua Louderback bio photo">


  <h3 itemprop="name">Joshua Louderback</h3>
  <p>Junior BSCS RTIS At DigiPen. Tools And Systems Programmer.</p>
  <a href="mailto:joshlouderback@gmail.com" class="author-social" target="_blank"><i class="fa fa-fw fa-envelope-square"></i> Email</a>
  <a href="http://twitter.com/joshlouderback" class="author-social" target="_blank"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a>
  
  
  <a href="http://linkedin.com/in/joshualouderback" class="author-social" target="_blank"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a>
  
  
  
  <a href="http://github.com/joshualouderback" class="author-social" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a>
  
  
  
  
  
  
  
  
  
  
  
</div>

  </div>
  <article class="post">
    <div class="headline-wrap">
      
        <h1><a href="/ActionFoundation/" rel="bookmark" title="Action Foundations (Part 1)">Action Foundations (Part 1)</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <h3 id="what-are-actions">What are <em>Actions</em>?</h3>

<p>An action can be thought of as an objective. For example, say you want to move an asteroid from a to b, that simply is an action. What if that position b is the player’s ship and we wanted to rotate the asteroid while it traveled to b? Now, say we want the lights in the room the player is in to fade to black, let the room stay dark for a few seconds, and then follow it with flashing red lights and alarm sounds. All of these things can simply be represented with actions to make scripting events simpler and faster than ever before. And I am going to show you how, so remember this scripted event because I will be referencing it throughout.</p>

<blockquote>

</blockquote>

<p><em>*Note: that this entire article is based on using C# and Unity 5, but the same techniques can be applied to other engines with some work.</em></p>

<hr />

<h3 id="base-action">Base Action</h3>

<p>An action is too generic to describe, but all actions will have a lot of the same foundation under the hood. These are things like:</p>

<ul>
  <li>Update-able, but each action will update differently.</li>
  <li>Can be paused and resumed.</li>
  <li>Or they can even be outright canceled.</li>
  <li>They manage themselves, so they need to keep track of themselves.</li>
  <li>Actions are hierarchical, so they look to their parents for info.</li>
</ul>

<p>So in that case, we need an abstract class that our all our different actions can build from. I also wanted to give you some context as to what an action is comprised of, since everything builds on this from here on out.</p>

<blockquote>

</blockquote>

<p><em>*Note: The code blocks are formatted to condense minor sections and reduce page length.</em></p>

<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">Action</span>
<span class="p">{</span>
  <span class="k">protected</span> <span class="kt">bool</span> <span class="n">running_</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>      <span class="c1">// Need to know when an action is running</span>
  <span class="k">protected</span> <span class="kt">bool</span> <span class="n">completed_</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>    <span class="c1">// Need to keep track of when the action is done</span>
  <span class="k">protected</span> <span class="n">ActionManager</span> <span class="n">parent_</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>      <span class="c1">// We need to know our parent for extra info</span>
  <span class="k">protected</span> <span class="n">Coroutine</span> <span class="n">routine_</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>  <span class="c1">// They keep track of their own routine</span>

  <span class="c1">// Constructor</span>
  <span class="k">public</span> <span class="nf">Action</span><span class="p">()</span> <span class="p">{}</span>

  <span class="c1">/////// Public Method /////// </span>
  <span class="c1">// Since actions manage themselves they start themselves</span>
  <span class="k">public</span> <span class="n">Coroutine</span> <span class="nf">StartAction</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="c1">// Set our routine, because we manage ourselves</span>
    <span class="n">routine_</span> <span class="p">=</span> <span class="n">parent_</span><span class="p">.</span><span class="n">GetTarget</span><span class="p">().</span><span class="n">StartCoroutine</span><span class="p">(</span><span class="n">Update</span><span class="p">());</span>
    <span class="c1">// Return the routine, just in case others want to yield on us</span>
    <span class="k">return</span> <span class="n">routine_</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">///////  Settors /////// </span>
  <span class="c1">// Actions look to their parents for information they manage</span>
  <span class="k">public</span> <span class="k">void</span> <span class="nf">SetParent</span><span class="p">(</span><span class="n">ActionManager</span> <span class="n">parent</span><span class="p">)</span> <span class="p">{</span> <span class="n">parent_</span> <span class="p">=</span> <span class="n">parent</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">public</span> <span class="k">void</span> <span class="nf">Pause</span><span class="p">()</span> <span class="p">{</span> <span class="n">parent_</span><span class="p">.</span><span class="n">paused_</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">public</span> <span class="k">void</span> <span class="nf">Resume</span><span class="p">()</span> <span class="p">{</span> <span class="n">parent_</span><span class="p">.</span><span class="n">paused_</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span> <span class="p">}</span>

  <span class="c1">/////// Gettors /////// </span>
  <span class="k">public</span> <span class="kt">bool</span> <span class="nf">IsCompleted</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">completed_</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">public</span> <span class="kt">bool</span> <span class="nf">IsRunning</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">running_</span><span class="p">;</span> <span class="p">}</span>

  <span class="c1">/////// Virtual methods ///////</span>
  <span class="c1">// We only want to be able to add actions within constructors (more on this later)</span>
  <span class="k">protected</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">AddAction</span><span class="p">(</span><span class="n">Action</span> <span class="n">action</span><span class="p">)</span> <span class="p">{</span> <span class="n">parent_</span><span class="p">.</span><span class="n">AddAction</span><span class="p">(</span><span class="n">action</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// Marked virtual since children need to ask their parents, </span>
  <span class="c1">// but parents to need override for their own logic.</span>
  <span class="k">public</span> <span class="k">virtual</span> <span class="kt">bool</span> <span class="nf">IsPaused</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">parent_</span><span class="p">.</span><span class="n">IsPaused</span><span class="p">();</span> <span class="p">}</span>
  <span class="c1">// Every action updates differently</span>
  <span class="k">public</span> <span class="k">virtual</span> <span class="n">IEnumerator</span> <span class="nf">Update</span><span class="p">()</span> <span class="p">{</span> <span class="k">yield</span> <span class="k">break</span><span class="p">;</span> <span class="p">}</span>
  <span class="c1">// Some actions may cancel differently</span>
  <span class="k">public</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">Cancel</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="c1">// Ensure all data is valid before blindly cancelling</span>
    <span class="k">if</span><span class="p">(</span><span class="n">routine_</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">parent_</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">Actions</span> <span class="n">target</span> <span class="p">=</span> <span class="n">parent</span><span class="p">.</span><span class="n">GetTarget</span><span class="p">();</span>
      <span class="k">if</span><span class="p">(</span><span class="n">target</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
        <span class="n">target</span><span class="p">.</span><span class="n">StopCoroutine</span><span class="p">(</span><span class="n">routine_</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<hr />

<h3 id="coroutines">Coroutines:</h3>

<p>Before we can dive into how each type of action works, we are going to need to understand coroutines. Unity defines a coroutine as a function that can suspend its execution (this is known as yielding) until the given YieldInstruction is finished. Since a coroutine can suspend its execution, it means you can have that function run over multiple frames. Coroutines are the foundation of actions. Let us look look at our example of an asteroid traveling from a to b. Normally we would write the component like this:</p>

<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">public</span> <span class="k">class</span> <span class="nc">AsteroidMover</span> <span class="p">:</span> <span class="n">MonoBehaviour</span> <span class="p">{</span>
  <span class="k">public</span> <span class="n">Transform</span> <span class="n">startMarker</span><span class="p">;</span>
  <span class="k">public</span> <span class="n">Transform</span> <span class="n">endMarker</span><span class="p">;</span>
  <span class="k">public</span> <span class="kt">float</span> <span class="n">duration</span> <span class="p">=</span> <span class="m">5.0F</span><span class="p">;</span>
  <span class="k">private</span> <span class="kt">float</span> <span class="n">currTime</span> <span class="p">=</span> <span class="m">0.0F</span><span class="p">;</span>

  <span class="c1">// Every frame let us try to lerp</span>
  <span class="k">void</span> <span class="nf">Update</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Calculate our time step</span>
    <span class="kt">float</span> <span class="n">t</span> <span class="p">=</span> <span class="n">currTime</span> <span class="p">/</span> <span class="n">duration</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">t</span> <span class="p">&lt;=</span> <span class="m">1.0F</span><span class="p">)</span> <span class="c1">// Only interpolate until we reach the end position</span>
      <span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Lerp</span><span class="p">(</span><span class="n">startMarker</span><span class="p">.</span><span class="n">position</span><span class="p">,</span> <span class="n">endMarker</span><span class="p">.</span><span class="n">position</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
    <span class="n">currTime</span> <span class="p">+=</span> <span class="n">Time</span><span class="p">.</span><span class="n">deltaTime</span><span class="p">;</span>        
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>There are a few annoyances that come up:</p>

<ul>
  <li>Once this is done lerping, we are wasting an update call unless we destroyed this object or component.</li>
  <li>How will we tell this object to start interpolating if it isn’t suppose to start right away?</li>
  <li>How do we communicate the current action is complete and we want to start the next one without sending multiple signals?</li>
</ul>

<p>Now trying to do this simple thing ends up creating little problems that we are going to have to handle. Well, this is why actions are awesome because they will remove these little problems and let you do focus on what is important. The first step in solving these problems is utilizing coroutines. Coroutines solve our first problem for free due to their nature of yielding until they stop being told to yield. Now, let us look at how we can modify our class with a coroutine to solve this problem:</p>

<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">public</span> <span class="k">class</span> <span class="nc">AsteroidMover</span> <span class="p">:</span> <span class="n">MonoBehaviour</span> <span class="p">{</span>
  <span class="k">public</span> <span class="n">Transform</span> <span class="n">startMarker</span><span class="p">;</span>
  <span class="k">public</span> <span class="n">Transform</span> <span class="n">endMarker</span><span class="p">;</span>
  <span class="k">public</span> <span class="kt">float</span> <span class="n">duration</span> <span class="p">=</span> <span class="m">5.0F</span><span class="p">;</span>
  <span class="k">private</span> <span class="kt">float</span> <span class="n">currTime</span> <span class="p">=</span> <span class="m">0.0F</span><span class="p">;</span>

  <span class="c1">// We can change our update function into a coroutine</span>
  <span class="n">IEnumerator</span> <span class="nf">Move</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Everytime we hit the yield statement, on the next frame </span>
    <span class="c1">// we will start at top of while loop and check it again</span>
    <span class="k">while</span><span class="p">(</span><span class="n">curr</span> <span class="p">&lt;</span> <span class="n">duration</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="c1">// Our lerp code stays the same</span>
      <span class="kt">float</span> <span class="n">t</span> <span class="p">=</span> <span class="n">currTime</span> <span class="p">/</span> <span class="n">duration</span><span class="p">;</span>
      <span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Lerp</span><span class="p">(</span><span class="n">startMarker</span><span class="p">.</span><span class="n">position</span><span class="p">,</span> <span class="n">endMarker</span><span class="p">.</span><span class="n">position</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
      <span class="n">currTime</span> <span class="p">+=</span> <span class="n">Time</span><span class="p">.</span><span class="n">deltaTime</span><span class="p">;</span>
      <span class="c1">// Now we want to yield until the next frame</span>
      <span class="k">yield</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span>  
    <span class="p">}</span>
    <span class="c1">// Once we pass the while loop, this function won&#39;t be called anymore</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>Look at that! We barely had to rewrite our code to fix that problem. Now the only major roadblock left is how do we tell this coroutine to start and how do we tell the following action to start after this one? If you think about our problem, all we are trying to do is create an order of actions. We are building a <em>sequence</em>!</p>

<blockquote>

</blockquote>

<p><a href="http://joshualouderback.com/ActionManagement/">Continue to part 2. (Action Management)</a></p>


      <hr />
      <footer role="contentinfo">
        <div class="social-share">
  <h4>Share on</h4>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=/ActionFoundation/" class="twitter" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=/ActionFoundation/" class="facebook" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=/ActionFoundation/" class="google-plus" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
  </ul>
</div><!-- /.social-share -->
        <p class="byline"><strong>Action Foundations (Part 1)</strong> was published on <time datetime="2016-01-30T00:00:00-08:00">January 30, 2016</time> and last modified on <time datetime="2016-01-30">January 30, 2016</time>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="/posts/">View all posts</a>)</small></h4>
    <ul>
    
      <li><a href="/ActionManagement/" title="Action Management (Part 2)">Action Management (Part 2)</a></li>
    
      <li><a href="/AddingActions/" title="Adding Actions (Part 2.5)">Adding Actions (Part 2.5)</a></li>
    
      <li><a href="/PausingAndCancelling/" title="Action Pausing And Cancelling (Part 3)">Action Pausing And Cancelling (Part 3)</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  
  <footer>
    

<span>&copy; 2016 Joshua Louderback. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a> theme.</span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>


  




</body>
</html>
